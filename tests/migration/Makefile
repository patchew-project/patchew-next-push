#
# Copyright (c) 2016-2018 Red Hat, Inc. and/or its affiliates
#
# Authors:
#   Dave Gilbert <dgilbert@redhat.com>
#
# This work is licensed under the terms of the GNU GPL, version 2 or later.
# See the COPYING file in the top-level directory.
#
export __note
override define __note
/* This file is automatically generated from
 * tests/migration/$<, edit that and then run
 * "make $@" inside tests/migration to update,
 * and then remember to send both in your patch submission.
 */
endef

all: x86-a-b-bootblock.h
# Dummy command so that make thinks it has done something
	@true

SRC_PATH=../..
include $(SRC_PATH)/rules.mak

x86_64_cross_prefix := $(call find-cross-prefix,x86_64)

x86-a-b-bootblock.h: x86-a-b-bootblock.S
	$(x86_64_cross_prefix)gcc -m32 -march=i486 -c $< -o x86.o
	$(x86_64_cross_prefix)objcopy -O binary x86.o x86.boot
	dd if=x86.boot of=x86.bootsect bs=256 count=2 skip=124
	echo "$$__note" > $@
	xxd -i x86.bootsect | sed -e 's/.*int.*//' >> $@

clean:
	rm -f *.bootsect *.boot *.o
